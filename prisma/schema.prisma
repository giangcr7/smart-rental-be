// prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ... (Giữ nguyên các Enum RoomStatus, ContractStatus, InvoiceStatus, Role)
enum RoomStatus {
  AVAILABLE
  OCCUPIED
  MAINTENANCE
}

enum ContractStatus {
  ACTIVE
  EXPIRED
  TERMINATED
}

enum InvoiceStatus {
  UNPAID
  PAID
  OVERDUE
}

enum Role {
  ADMIN
  TENANT
}

model Branch {
  id        Int      @id @default(autoincrement())
  name      String
  address   String
  manager   String
  
  image     String?  // <--- MỚI: Link ảnh cổng hoặc toàn cảnh khu trọ
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  deletedAt DateTime?

  rooms     Room[]
}

model Room {
  id          Int        @id @default(autoincrement())
  roomNumber  String
  price       Decimal    @db.Decimal(10, 2)
  area        Float?
  status      RoomStatus @default(AVAILABLE)
  
  image       String?    // <--- MỚI: Link ảnh phòng (Thumbnail)
  
  branchId    Int
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  deletedAt   DateTime?

  branch    Branch     @relation(fields: [branchId], references: [id])
  contracts Contract[]
  invoices  Invoice[]
}

model User {
  id            Int      @id @default(autoincrement())
  email         String   @unique 
  password      String   
  fullName      String
  phone         String?  
  identityCard  String?  @unique 
  role          Role     @default(TENANT)
  
  avatar        String?  // <--- MỚI: Link ảnh đại diện (Avatar)
  
  // Data cho AI & IoT
  faceDescriptor Float[] 
  fingerprintId  Int?     @unique

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  deletedAt     DateTime?

  contracts     Contract[]
}

// ... (Giữ nguyên model Contract)
model Contract {
  id        Int            @id @default(autoincrement())
  startDate DateTime
  endDate   DateTime
  deposit   Decimal        @db.Decimal(10, 2)
  status    ContractStatus @default(ACTIVE)
  
  scanImage String?        // <--- MỚI: Link ảnh chụp hợp đồng giấy đã ký
  
  userId    Int
  roomId    Int
  createdAt DateTime       @default(now())
  updatedAt DateTime       @updatedAt
  deletedAt DateTime?

  user      User           @relation(fields: [userId], references: [id])
  room      Room           @relation(fields: [roomId], references: [id])
}
// ... (Giữ nguyên model Invoice)
model Invoice {
  id             Int           @id @default(autoincrement())
  month          Int
  year           Int
  
  oldElectricity Int
  newElectricity Int
  oldWater       Int
  newWater       Int
  
  serviceFee     Decimal       @db.Decimal(10, 2) @default(0)
  totalAmount    Decimal       @db.Decimal(10, 2)
  status         InvoiceStatus @default(UNPAID)
  
  paymentProof   String?       // <--- MỚI (Optional): Ảnh chụp màn hình chuyển khoản
  
  roomId         Int
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt
  deletedAt      DateTime?

  room           Room          @relation(fields: [roomId], references: [id])
}